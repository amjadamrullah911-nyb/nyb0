[build]
  publish   = "./"
  functions = "netlify/functions"
  # Kalau kamu TIDAK butuh prebuild apa pun, cukup install & build kosong:
  command   = "npm install && npm run build"

[build.environment]
  NODE_VERSION = "20.18.3"

# ---------- Redirects ----------
[[redirects]]
  from = "/"
  to   = "/login.html"
  status = 302
  force  = true

[[redirects]]
  from = "/index"
  to   = "/index.html"
  status = 200

[[redirects]]
  from = "/login"
  to   = "/login.html"
  status = 200

[[redirects]]
  from = "/reset-password"
  to   = "/reset-password.html"
  status = 200

[[redirects]]
  from = "/functions/*"
  to   = "/.netlify/functions/:splat"
  status = 200

[[redirects]]
  from = "/api/*"
  to   = "/.netlify/functions/:splat"
  status = 200

# ---------- Security headers (CSP) ----------
[[headers]]
  for = "/*"
  [headers.values]
    Content-Security-Policy = "default-src 'self'; script-src 'self' https://telegram.org https://www.gstatic.com https://apis.google.com https://cdnjs.cloudflare.com https://code.jquery.com https://embed.tawk.to https://va.tawk.to https://cdn.jsdelivr.net https://*.firebaseio.com https://*.asia-southeast1.firebasedatabase.app 'unsafe-inline' 'unsafe-eval'; style-src 'self' https://fonts.googleapis.com https://cdnjs.cloudflare.com https://embed.tawk.to 'unsafe-inline'; img-src 'self' data: blob: https://www.gstatic.com https://i.ytimg.com https://upload.wikimedia.org https://i.ibb.co https://pagead2.googlesyndication.com https://embed.tawk.to https://va.tawk.to https://tawk.to https://*.tawk.to https://*.telegram.org https://oauth.telegram.org cdn.jsdelivr.net https://tawk.link https://s3.amazonaws.com; connect-src 'self' https://telegram.org https://oauth.telegram.org https://api.telegram.org https://www.gstatic.com https://apis.google.com https://identitytoolkit.googleapis.com https://firestore.googleapis.com https://firebase.googleapis.com https://securetoken.googleapis.com https://embed.tawk.to https://va.tawk.to https://tawk.to https://*.tawk.to wss://*.tawk.to https://cdn.jsdelivr.net https://*.firebaseio.com wss://*.firebaseio.com https://cekrekening-9e79e-default-rtdb.asia-southeast1.firebasedatabase.app wss://*.asia-southeast1.firebasedatabase.app https://*.asia-southeast1.firebasedatabase.app; font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com https://embed.tawk.to https://tawk.to https://*.tawk.to wss://*.tawk.to data:; frame-src 'self' https://oauth.telegram.org https://www.youtube.com https://googleads.g.doubleclick.net https://embed.tawk.to https://va.tawk.to https://tawk.to https://*.tawk.to wss://*.tawk.to https://*.asia-southeast1.firebasedatabase.app https://s-apse1b-nss-202.asia-southeast1.firebasedatabase.app; object-src 'none'; upgrade-insecure-requests;"

[[headers]]
  for = "/assets/css/*"
  [headers.values]
    Content-Type = "text/css"

# ---------- Functions (GLOBAL) ----------
[functions]
  node_bundler = "esbuild"
  external_node_modules = ["googleapis"]
  included_files = ["netlify/functions/*.json"]